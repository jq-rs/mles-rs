<!DOCTYPE html>

<html>
<head>
<title>Mles WebSocket Channels</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<script type="text/javascript" src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
<style>
body {
    padding: 0;
    margin: 0;
}

.body_container {
    width: 1000px;
    margin: 0 auto;
    padding: 0;
}

.clear {
    clear: both;
}

.green {
    color: #8aaf0d;
}

#header {
    margin: 0 auto;
    padding: 50px 0;
    text-align: center;
}

#header h1,#header p.channel_header {
    font-family: 'Open Sans', sans-serif;
    font-weight: 300;
}

#header p.channel_header {
    font-size: 18px;
    display: none;
}

.box_shadow {
    background: #f3f4f6;
    border: 1px solid #e4e4e4;
    -moz-box-shadow: 0px 0px 2px 1px #e5e5e5;
    -webkit-box-shadow: 0px 0px 2px 1px #e5e5e5;
    box-shadow: 0px 0px 2px 1px #e5e5e5;
}

#prompt_name_container {
    margin: 0 auto;
    width: 350px;
    text-align: center;
}

#prompt_name_container p {
    font-family: 'Open Sans', sans-serif;
    font-weight: 300;
    font-size: 24px;
    color: #5e5e5e;
}

#prompt_name_container #input_name {
    border: 1px solid #dddddd;
    padding: 10px;
    width: 250px;
    display: block;
    margin: 0 auto;
    outline: none;
    font-family: 'Open Sans', sans-serif;
}

#prompt_name_container #input_channel {
    border: 1px solid #dddddd;
    padding: 10px;
    width: 250px;
    display: block;
    margin: 0 auto;
    outline: none;
    font-family: 'Open Sans', sans-serif;
}

#prompt_name_container #btn_join {
    border: none;
    width: 100px;
    display: block;
    outline: none;
    font-family: 'Open Sans', sans-serif;
    color: #fff;
    background: #96be0e;
    font-size: 18px;
    padding: 5px 20px;
    margin: 15px auto;
    cursor: pointer;
}

#message_container {
    display: none;
    width: 500px;
    margin: 0 auto;
    background: #fff;
    padding: 15px 0 0 0;
}

#messages {
    margin: 0;
    padding: 0;
    height: 300px;
    overflow: scroll;
    overflow-x: hidden;
}

#messages li {
    list-style: none;
    font-family: 'Open Sans', sans-serif;
    font-size: 16px;
    padding: 10px 20px;
}

#messages li.new,#messages li.exit {
    font-style: italic;
    color: #bbbbbb;
}

#messages li span.name {
    color: #8aaf0d;
}

#messages li span.red {
    color: #e94e59;
}

#input_message_container {
    margin: 40px 20px 0 20px;
}

#input_message {
    background: #f0f0f0;
    border: none;
    font-size: 20px;
    font-family: 'Open Sans', sans-serif;
    outline: none;
    padding: 10px;
    float: left;
    margin: 0;
    width: 348px;
}

#btn_send {
    float: left;
    margin: 0;
    border: none;
    color: #fff;
    font-family: 'Open Sans', sans-serif;
    background: #96be0e;
    outline: none;
    padding: 10px 20px;
    font-size: 20px;
    cursor: pointer;
}

#btn_close {
    margin: 0;
    border: none;
    color: #fff;
    font-family: 'Open Sans', sans-serif;
    background: #e94e59;
    outline: none;
    padding: 10px 20px;
    font-size: 20px;
    cursor: pointer;
    width: 100%;
    margin: 30px 0 0 0;
}
</style>
<script>
var myname = '';
var mychannel = '';
var socket_url = '127.0.0.1';
var port = '8076';
 
$(document).ready(function() {
                  $("#form_submit, #form_send_message").submit(function(e) {
                                                               e.preventDefault();
                                                               join();
                                                               });
});
 
var webSocket;
 
function join() {
    if ($('#input_name').val().trim().length <= 0 || $('#input_channel').val().trim().length <= 0) {                                          
        alert('Enter your name and channel');
    } else {
        myname = $('#input_name').val().trim();
        mychannel = $('#input_channel').val().trim();

        $('#prompt_name_container').fadeOut(500, function() {
            openSocket();
        });
    }

    return false;
}

function openSocket() {
    if (webSocket !== undefined && webSocket.readyState !== WebSocket.CLOSED) {
        return;
    }
    webSocket = new WebSocket("ws://" + socket_url + ":" + port
                              + "?myname=" + myname
                              + "&mychannel=" + mychannel, "mles-websocket");
    webSocket.onopen = function(event) {
        $('p.channel_header').html(
                                   'Channel <span class="green">' + mychannel + '</span>').fadeIn();
        $('#message_container').fadeIn();

        if (event.data === undefined)
            return;

    };

    webSocket.onmessage = function(event) {
        parseMessage(event.data);
    };

    webSocket.onclose = function(event) {
        alert('Error! Connection is closed. Try connecting again.');
    };
}

function send() {
    var message = $('#input_message').val();

    if (message.trim().length > 0) {
        sendMessageToServer(message);
    } else {
        alert('Please enter a message to send!');
    }

}

function closeSocket() {
    webSocket.close();

    $('#message_container').fadeOut(600, function() {
        $('#prompt_name_container').fadeIn();
        myname = '';
        mychannel = '';
        $('#messages').html('');
        $('p.channel_header').hide();
    });
}

function parseMessage(message) {
    var jObj = $.parseJSON(message);

    var li = '<li class="new"><span class="name">' + jObj.name + '</span> '
        + jObj.message + '</li>';
    $('#messages').append(li);

    $('#input_message').val('');
    $('#messages').scrollTop($('#messages').height());
}

function sendMessageToServer(message) {
    var json = '{""}';
    var myObject = new Object();
    myObject.name = myname;
    myObject.channel = mychannel;
    myObject.message = message;
    json = JSON.stringify(myObject);
    webSocket.send(json);
}
</script>
</head>
<body>
<div class="body_container">

    <div id="header">
        <h1>Mles Websocket Channels</h1>
        <p class='channel_header'>
        </p>
    </div>

    <div id="prompt_name_container" class="box_shadow">
        <p>Your name?</p>
        <form id="form_submit" method="post">
            <input type="text" id="input_name" />
            <p>Channel?</p>
            <input type="text" id="input_channel" />  <input type="submit"
            value="JOIN" id="btn_join">
        </form>
    </div>

    <div id="message_container" class="box_shadow">

        <ul id="messages">
        </ul>


        <div id="input_message_container">
            <form id="form_send_message" method="post" action="#">
                <input type="text" id="input_message"
                placeholder="Type your message here..." /> <input type="submit"
                id="btn_send" onclick="send();" value="Send" />
                <div class="clear"></div>
            </form>
        </div>
        <div>
            <input type="button" onclick="closeSocket();"
            value="Exit" id="btn_close" />
        </div>

    </div>

</div>

</body>
</html>
